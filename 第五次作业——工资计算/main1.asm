STKSEG SEGMENT
    DW 32 DUP(0)
STKSEG ENDS

DATASEG SEGMENT
    YEAR_STRINGS DB '1975','1976','1977','1978','1979','1980','1981','1982','1983'
                 DB '1984','1985','1986','1987','1988','1989','1990','1991','1992'
                 DB '1993','1994','1995'
    TOTAL_REVENUE DD 16,22,382,1356,2390,8000,16000,24486,50065,97479,140417,197514
                  DD 345980,590827,803530,1183000,1843000,2759000,3753000,4649000,5937000
    WORKERS_COUNT DW 3,7,9,13,28,38,130,220,476,778,1001,1442,2258,2793,4037,5635,8226
                  DW 11542,14430,15257,17800
DATASEG ENDS

TABLE SEGMENT
    DB 21 DUP('data init ??')
TABLE ENDS

CODESEG SEGMENT
    ASSUME CS:CODESEG, DS:DATASEG, ES:TABLE
    EXTRN PRINT_NUM: FAR, PRINT_TAB: FAR, PRINT_NEWLINE: FAR
MAIN PROC FAR
    MOV AX, DATASEG
    MOV DS, AX
    MOV AX, TABLE
    MOV ES, AX
    MOV CX, 21
    MOV SI, OFFSET YEAR_STRINGS
    MOV DI, 0
INSERT_YEARS:
    MOVSB
    MOVSB
    MOVSB
    MOVSB
    ADD DI, 12
    LOOP INSERT_YEARS
    MOV CX, 21
    MOV SI, OFFSET TOTAL_REVENUE
    MOV DI, 5
INSERT_REVENUE:
    MOV AX, [SI]
    MOV DX, [SI + 2]
    MOV ES:[DI], AX
    MOV ES:[DI + 2], DX
    ADD DI, 16
    ADD SI, 4
    LOOP INSERT_REVENUE
    MOV CX, 21
    MOV SI, OFFSET WORKERS_COUNT
    MOV DI, 10
INSERT_WORKERS:
    MOV AX, [SI]
    MOV ES:[DI], AX
    ADD DI, 16
    ADD SI, 2
    LOOP INSERT_WORKERS
    MOV CX, 21
    MOV BX, 13
    MOV SI, OFFSET TOTAL_REVENUE
    MOV DI, OFFSET WORKERS_COUNT
CALC_AVERAGE:
    PUSH BX
    MOV AX, [SI]
    MOV DX, [SI + 2]
    ADD SI, 4
    MOV BX, [DI]
    ADD DI, 2
    DIV BX
    POP BX
    PUSH DI
    MOV DI, BX
    MOV ES:[DI], AX
    ADD DI, 16
    MOV BX, DI
    POP DI
    LOOP CALC_AVERAGE
    MOV BX, 21
    MOV SI, 0
    MOV AX, TABLE
    MOV DS, AX
PRINT_ALL:
    CALL PRINT_TAB
PRINT_YEAR:
    MOV CX, 4
PRINT_DIGIT:
    MOV DL, [SI]
    MOV AH, 02H
    INT 21H
    INC SI
    LOOP PRINT_DIGIT
    CALL PRINT_TAB
    CALL PRINT_TAB
    CALL PRINT_TAB
PRINT_REVENUE:
    INC SI
    MOV AX, [SI]
    ADD SI, 2
    MOV DX, [SI]
    ADD SI, 2
    CALL PRINT_NUM
    CALL PRINT_TAB
    CALL PRINT_TAB
PRINT_WORKERS:
    INC SI
    MOV AX, [SI]
    MOV DX, 0
    ADD SI, 2
    CALL PRINT_NUM
    CALL PRINT_TAB
    CALL PRINT_TAB
PRINT_AVERAGE:
    INC SI
    MOV AX, [SI]
    MOV DX, 0
    ADD SI, 2
    CALL PRINT_NUM
    INC SI
    CALL PRINT_NEWLINE
    DEC BX
    JNZ PRINT_ALL
    MOV AX, 4C00H
    INT 21H
MAIN ENDP
CODESEG ENDS
    END MAIN
